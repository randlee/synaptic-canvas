name: Complete Validation Suite

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  validate-versions:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Run version audit
        run: python3 scripts/audit-versions.py --verbose

  validate-agents:
    runs-on: ubuntu-latest
    # Known issues: version mismatches in agent registry need fixing
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate agent registry
        run: python3 scripts/validate-agents.py

  validate-manifest-artifacts:
    runs-on: ubuntu-latest
    # Known issues: orphaned files and invalid scripts in some packages
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate manifest artifacts
        run: python3 scripts/validate-manifest-artifacts.py

  validate-marketplace-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate marketplace synchronization
        run: python3 scripts/validate-marketplace-sync.py

  validate-frontmatter:
    runs-on: ubuntu-latest
    # Known issues: missing required fields and invalid values in frontmatter
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate frontmatter schema
        run: python3 scripts/validate-frontmatter-schema.py

  validate-cross-references:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate cross-references
        run: python3 scripts/validate-cross-references.py

  validate-script-references:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Validate script references
        run: python3 scripts/validate-script-references.py

  security-scan:
    runs-on: ubuntu-latest
    # Known issues: false positives in docs/tests, missing LICENSE files
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml pydantic
      - name: Run security scan
        run: python3 scripts/security-scan.py
